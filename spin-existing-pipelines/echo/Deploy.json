{"appConfig": {}, "application": "echo", "disabled": true, "id": "3f8fff0d-89b4-47d9-ba8d-a773499316a1", "index": 0, "keepWaitingPipelines": false, "lastModifiedBy": "andy.quick@urbanairship.com", "limitConcurrent": true, "name": "Deploy", "parameterConfig": [{"default": "echo-1", "description": "", "hasOptions": false, "label": "deployment", "name": "deployment", "options": [{"value": "echo-1"}, {"value": ""}], "pinned": true, "required": false}, {"default": "", "description": "Image version tag", "hasOptions": false, "label": "tag", "name": "tag", "options": [{"value": ""}], "pinned": true, "required": false}], "schema": "1", "stages": [{"account": "gcb-account", "application": "echo", "buildDefinition": {"steps": [{"args": ["cp", "gs://ua-ops-deploy_cloudbuild/secrets/id_rsa.enc", "id_rsa.enc"], "id": "Get Github credentials", "name": "gcr.io/cloud-builders/gsutil", "volumes": [{"name": "ssh", "path": "/root/.ssh"}]}, {"args": ["kms", "decrypt", "--ciphertext-file=id_rsa.enc", "--plaintext-file=/root/.ssh/id_rsa", "--location=global", "--keyring=cloudbuilder", "--key=github-key", "--project=ua-ops-deploy"], "name": "gcr.io/cloud-builders/gcloud", "volumes": [{"name": "ssh", "path": "/root/.ssh"}]}, {"args": ["-c", "chmod 600 /root/.ssh/id_rsa\ncat <<EOF >/root/.ssh/config\nHostname github.com\nIdentityFile /root/.ssh/id_rsa\nEOF\nssh-keyscan -t rsa github.com > known_hosts\nmv known_hosts /root/.ssh/known_hosts\n"], "entrypoint": "bash", "name": "gcr.io/cloud-builders/git", "volumes": [{"name": "ssh", "path": "/root/.ssh"}]}, {"args": ["-c", "git clone git@github.com:urbanairship/gcp-infrastructure\n"], "entrypoint": "bash", "name": "gcr.io/cloud-builders/git", "volumes": [{"name": "ssh", "path": "/root/.ssh"}]}, {"args": ["-c", "cd gcp-infrastructure\npip install ruamel.yaml\npython version.py --deployment ${parameters[\"deployment\"]} --tag ${parameters[\"tag\"]}\n"], "entrypoint": "bash", "name": "gcr.io/cloud-builders/git"}, {"args": ["-c", "cd gcp-infrastructure\ngit config --global user.name \"Spinnaker\"\ngit config --global user.email \"infra@urbanairship.com\"\ngit commit -am \"Automatic image tagging by Spinnaker\"\ngit push origin master\n"], "entrypoint": "bash", "name": "gcr.io/cloud-builders/git", "volumes": [{"name": "ssh", "path": "/root/.ssh"}]}]}, "buildDefinitionSource": "text", "name": "Set Version", "refId": "1", "requisiteStageRefIds": [], "stageEnabled": {"expression": "parameters['tag'] != null && parameters['tag'] != ''", "type": "expression"}, "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["render", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--env=project=${_PROJECT},deployment=${_NAME}", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "render", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["deploy", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${parameters[\"deployment\"]}"], "id": "deploy", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}", "waitFor": ["render"]}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-stag"}}, "buildDefinitionSource": "text", "comments": "<ul>\n      <li><a target=\"_blank\"  href=\"https://console.cloud.google.com/compute/instanceGroups/details/us-east1/${parameters.deployment}?project=ua-ops-transitional-stag&amp;organizationId=272278969548\">Instance Group Dashboard</a></li>\n      <li><a target=\"_blank\"  href=\"https://console.cloud.google.com/logs/viewer?resource=gce_instance&amp;project=ua-ops-transitional-stag&amp;organizationId=272278969548&amp;minLogLevel=0&amp;expandAll=false&amp;advancedFilter=resource.type%3D%22gce_instance%22%0Alabels.%22compute.googleapis.com%2Fresource_name%22%3A%22${parameters.deployment}-instance%22\">Instance Group Logs</a></li>\n</ul>", "name": "Deploy to Stag", "refId": "2", "requisiteStageRefIds": ["1"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-stag", "_REGION": "us-east1"}}, "buildDefinitionSource": "text", "name": "Update instances", "refId": "3", "requisiteStageRefIds": ["2"], "type": "googleCloudBuild"}, {"failPipeline": true, "judgmentInputs": [], "name": "Continue  Deploy?", "notifications": [], "refId": "5", "requisiteStageRefIds": ["3"], "type": "manualJudgment"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["render", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--env=project=${_PROJECT},deployment=${_NAME}", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "render", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["deploy", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "deploy", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}", "waitFor": ["render"]}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "6ca6e04bf697c03fbdac2c0ab5e7ad8334ef00b0", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-eucs"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Deploy to EUCS", "refId": "7", "requisiteStageRefIds": ["5"], "stageEnabled": {"expression": "#judgment(\"Continue Deploy?\").equals(\"continue\")", "type": "expression"}, "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["render", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--env=project=${_PROJECT},deployment=${_NAME}", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "render", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["deploy", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "deploy", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}", "waitFor": ["render"]}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "6ca6e04bf697c03fbdac2c0ab5e7ad8334ef00b0", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-prod"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Deploy to Prod", "refId": "8", "requisiteStageRefIds": ["5"], "stageEnabled": {"expression": "$#judgment(\"Continue Deploy?\").equals(\"continue\")", "type": "expression"}, "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-eucs", "_REGION": "europe-west1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Canary", "refId": "9", "requisiteStageRefIds": ["7"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-prod", "_REGION": "us-east1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Canary", "refId": "10", "requisiteStageRefIds": ["8"], "type": "googleCloudBuild"}, {"completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "judgmentInputs": [], "name": "Continue Prod Deploy?", "notifications": [], "refId": "11", "requisiteStageRefIds": ["10"], "type": "manualJudgment"}, {"completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "judgmentInputs": [], "name": "Continue EUCS Deploy?", "notifications": [], "refId": "12", "requisiteStageRefIds": ["9"], "type": "manualJudgment"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-prod", "_REGION": "us-east1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 1", "refId": "13", "requisiteStageRefIds": ["11"], "stageEnabled": {"expression": "#judgment(\"Continue Prod Deploy?\").equals(\"continue\")", "type": "expression"}, "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-eucs", "_REGION": "europe-west1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 1", "refId": "14", "requisiteStageRefIds": ["12"], "stageEnabled": {"expression": "#judgment(\"Continue EUCS Deploy?\").equals(\"continue\")", "type": "expression"}, "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-eucs", "_REGION": "europe-west1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 2", "refId": "15", "requisiteStageRefIds": ["14"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-eucs", "_REGION": "europe-west1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 3", "refId": "16", "requisiteStageRefIds": ["15"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-prod", "_REGION": "us-east1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 2", "refId": "17", "requisiteStageRefIds": ["13"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "echo", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-gcp-alpha-testing"], "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\necho \"JENKINS:\"\necho \"- BUILD NUMBER: ${_JENKINS_BUILD_NUMBER}\"\necho \"- BUILD URL: ${_JENKINS_BUILD_URL}\"\necho \"- JOB NAME: ${_JENKINS_JOB_NAME}\"\necho \"- GIT COMMIT: ${_JENKINS_GIT_COMMIT}\"\necho \"- GIT URL: ${_JENKINS_GIT_URL}\"\necho \"- GIT BRANCH: ${_JENKINS_GIT_BRANCH}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method zonal --project ${_PROJECT} --region ${_REGION} --group ${_NAME}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v5.0.0", "_JENKINS_GIT_BRANCH": "origin/master", "_JENKINS_GIT_COMMIT": "HEAD", "_JENKINS_GIT_URL": "git@github.com:urbanairship/gcp-infrastructure.git", "_JENKINS_JOB_NAME": "gcp-infrastructure", "_NAME": "${parameters[\"deployment\"]}", "_PROJECT": "ua-ops-transitional-prod", "_REGION": "us-east1"}}, "buildDefinitionSource": "text", "completeOtherBranchesThenFail": true, "continuePipeline": false, "failPipeline": false, "name": "Zone 3", "refId": "18", "requisiteStageRefIds": ["17"], "type": "googleCloudBuild"}], "triggers": [], "updateTs": "1574789482468"}