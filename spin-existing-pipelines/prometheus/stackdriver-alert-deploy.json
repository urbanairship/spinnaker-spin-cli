{"application": "prometheus", "id": "94e50af3-0ffc-40a3-b387-2d47a5772216", "index": 2, "keepWaitingPipelines": false, "lastModifiedBy": "scott.frazier@airship.com", "limitConcurrent": true, "name": "stackdriver-alert-deploy", "notifications": [{"address": "infra", "level": "pipeline", "type": "slack", "when": ["pipeline.starting", "pipeline.complete", "pipeline.failed"]}], "schema": "1", "stages": [{"account": "gcb-account", "application": "prometheus", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["render", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--env=project=${_PROJECT},deployment=${_NAME}", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "render", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["deploy", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "deploy", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}", "waitFor": ["render"]}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v6.0.0", "_NAME": "stackdriver-prometheus-0", "_PROJECT": "ua-ops-analytics"}, "timeout": "1800s"}, "buildDefinitionSource": "text", "name": "USCS  Deploy", "refId": "1", "requisiteStageRefIds": [], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "prometheus", "buildDefinition": {"options": {"substitutionOption": "ALLOW_LOOSE"}, "steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "echo \"GCP DEPLOY:\"\necho \"- DEPLOY: ${_NAME}\"\necho \"- PROJECT: ${_PROJECT}\"\necho \"CHOOCHER:\"\necho \"- VERSION: ${_CHOOCHER_VER}\"\necho \"- LOG_LEVEL: ${_CHOOCHER_LOG_LEVEL}\"\n"], "id": "info", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["render", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--env=project=${_PROJECT},deployment=${_NAME}", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "render", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}, {"args": ["deploy", "--project=${_PROJECT}", "--deployment=deployments.yaml", "--log-level=${_CHOOCHER_LOG_LEVEL}", "${_NAME}"], "id": "deploy", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}", "waitFor": ["render"]}], "substitutions": {"_CHOOCHER_LOG_LEVEL": "INFO", "_CHOOCHER_VER": "v6.0.0", "_NAME": "stackdriver-prometheus-eucs-0", "_PROJECT": "ua-ops-analytics"}, "timeout": "1800s"}, "buildDefinitionSource": "text", "name": "EUCS  deploy", "refId": "2", "requisiteStageRefIds": [], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "prometheus", "buildDefinition": {"steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_DEPLOYMENT}-${_REGION}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_VER": "v6.0.0", "_DEPLOYMENT": "stackdriver-prometheus-0", "_PROJECT": "ua-ops-analytics", "_REGION": "us-west1"}, "timeout": "3600s"}, "buildDefinitionSource": "text", "name": "USCS West Update", "refId": "3", "requisiteStageRefIds": ["1"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "prometheus", "buildDefinition": {"steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_DEPLOYMENT}-${_REGION}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_VER": "v6.0.0", "_DEPLOYMENT": "stackdriver-prometheus-eucs-0", "_PROJECT": "ua-ops-analytics", "_REGION": "us-west1"}, "timeout": "3600s"}, "buildDefinitionSource": "text", "name": "EUCS \"West\" Update", "refId": "4", "requisiteStageRefIds": ["2"], "type": "googleCloudBuild"}, {"failPipeline": true, "instructions": "Please verify that your changes are working in EUCS before continuing the deploy.", "judgmentInputs": [], "name": "Continue EUCS?", "notifications": [], "refId": "5", "requisiteStageRefIds": ["4"], "type": "manualJudgment"}, {"failPipeline": true, "judgmentInputs": [], "name": "Continue USCS?", "notifications": [], "refId": "6", "requisiteStageRefIds": ["3"], "type": "manualJudgment"}, {"account": "gcb-account", "application": "prometheus", "buildDefinition": {"steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_DEPLOYMENT}-${_REGION}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_VER": "v6.0.0", "_DEPLOYMENT": "stackdriver-prometheus-eucs-0", "_PROJECT": "ua-ops-analytics", "_REGION": "us-east1"}, "timeout": "3600s"}, "buildDefinitionSource": "text", "name": "EUCS \"East\" Update", "refId": "7", "requisiteStageRefIds": ["5"], "type": "googleCloudBuild"}, {"account": "gcb-account", "application": "prometheus", "buildDefinition": {"steps": [{"args": ["source", "repos", "clone", "github_urbanairship_gcp-infrastructure", "./", "--project=ua-ops-deploy"], "id": "Clone gcp-infrastructure", "name": "gcr.io/cloud-builders/gcloud"}, {"args": ["/bin/ash", "-c", "./update_ig.py --method single --project ${_PROJECT} --region ${_REGION} --group ${_DEPLOYMENT}-${_REGION}-igm\n"], "id": "update-ig", "name": "gcr.io/ua-ops-artifacts/choocher:${_CHOOCHER_VER}"}], "substitutions": {"_CHOOCHER_VER": "v6.0.0", "_DEPLOYMENT": "stackdriver-prometheus-0", "_PROJECT": "ua-ops-analytics", "_REGION": "us-east1"}, "timeout": "3600s"}, "buildDefinitionSource": "text", "name": "USCS East Update", "refId": "8", "requisiteStageRefIds": ["6"], "type": "googleCloudBuild"}], "triggers": [], "updateTs": "1600462238685"}